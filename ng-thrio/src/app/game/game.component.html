<canvas #rendererCanvas id="renderer-canvas"></canvas>

<div class="vignette" [class.loading]="!rs.room || rs.room?.status === 'over'">
  <h4 class="waiting" *ngIf="!rs.room">Loading</h4>
</div>

<!-- <div class="notif" *ngIf="!authService.dbUser?.token">
  <p>
    Would you like to be notified <br />
    when it's your turn again?
  </p>
  <div class="options">
    <i
      class="fas fa-check clickable"
      (click)="authService.requestPermission()"
    ></i>
    <i class="fas fa-times clickable" (click)="rs.pushRequest = false"></i>
  </div>
</div> -->

<div
  class="gameover"
  [@fade]
  *ngIf="rs.room?.status === 'over' && rs.room?.players[rs.room?.victor]"
>
  <h3>
    {{
      rs.room?.victor === rs.playerIdx
        ? 'You'
        : rs.room?.players[rs.room?.victor]?.name
    }}
    won
  </h3>
  <button
    (click)="rs.resetRoom()"
    *ngIf="rs.playerIdx === 0; else showWaitingForReset"
  >
    Rematch
  </button>
  <ng-template #showWaitingForReset>
    <p>Waiting on {{ rs.room?.players[0]?.name }} to rematch</p>
  </ng-template>
</div>

<div class="header" *ngIf="rs.room">
  <p class="room-code" [class.lg]="rs.room?.status === 'waiting'">
    <span *ngIf="rs.playerIdx < 0">SPECTATING</span> {{ rs.room?.roomCode }}
    <i
      class="fas fa-share clickable"
      (click)="shareRoom()"
      *ngIf="canShare && rs.room?.status === 'waiting'"
    ></i>
  </p>
  <div class="players">
    <div
      *ngFor="let player of rs.room?.players; let i = index"
      class="player"
      [class.next]="rs.room?.nextPlayerIdx === i"
      [class.me]="rs.playerIdx === i"
    >
      <i class="fas fa-chevron-right next-marker"></i>
      <p>
        {{ player.name }}
      </p>
      <i class="fas fa-star side-i" *ngIf="player?.host"></i>
    </div>

    <p *ngFor="let i of rs.waiting" class="waiting">waiting for player</p>
  </div>
</div>

<div class="controls">
  <i
    class="fas fa-home fa-flip-horizontal clickable"
    (click)="rs.leaveRoom()"
  ></i>

  <div class="chat" [class.open]="chatOpen">
    <i class="fas fa-chevron-up clickable" (click)="chatOpen = !chatOpen"></i>
    <p *ngIf="rs.chat?.length"></p>
    <ng-container *ngIf="chatOpen">
      <p *ngFor="let item of rs.chat"><span>{{ rs.room?.players[item.playerIdx]?.name }}</span> {{ item.msg }}</p>
    </ng-container>
  </div>

</div>

<div>
  <!-- <input *ngIf="chatOpen"> -->
</div>
